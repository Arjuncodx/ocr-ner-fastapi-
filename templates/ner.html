<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NER — Image to Entities</title>
<style>
  :root{ --bg1:#0f172a; --bg2:#1e293b; --accent1:#4f46e5; --accent2:#06b6d4; --glass-border: rgba(255,255,255,0.12); --radius:14px; }
  html,body{ height:100%; margin:0; font-family:Inter, system-ui, sans-serif; background: linear-gradient(-45deg,var(--bg1),var(--bg2)); color:#e6eefb; }
  header{ padding:18px 36px; display:flex; justify-content:space-between; align-items:center; }
  .logo{ font-weight:800; background: linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

  main{ padding:110px 20px 80px; }
  .container{ width:min(1180px,94%); margin:0 auto; display:grid; grid-template-columns: 1fr 420px; gap:36px; }

  .left h1{ margin:0 0 10px 0; font-size:2.2rem; }
  .card{ background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); padding:20px; border-radius:14px; border:1px solid var(--glass-border); }

  .drop-area{ padding:26px; border-radius:12px; border:2px dashed rgba(255,255,255,0.06); min-height:140px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.01); }
  .controls{ margin-top:12px; display:flex; gap:10px; align-items:center; }

  footer{ text-align:center; padding:16px; color:#93a7c2; }
  @media(max-width:980px){ .container{ grid-template-columns:1fr; } }
</style>
</head>
<body>
<header>
  <div class="logo">OCR Model</div>
  <nav>
    <a href="/">Home</a>
    <a href="/ocr">Image OCR</a>
  </nav>
</header>

<main>
  <div class="container">
    <div class="left">
      <h1>Image → Entities (NER)</h1>
      <p style="color:#bcd7ee; margin-top:0">Upload a business card, invoice, or document image. Server runs OCR + spaCy NER and returns labeled entities: NAME, ORG, DES, PHONE, EMAIL, WEB.</p>

      <div class="card" style="margin-top:18px;">
        <h3 style="margin:0 0 8px 0; color:#eaf4ff">About this tool</h3>
        <p style="color:#bcd7ee; margin:0">We reconstruct tokens from Tesseract so entity offsets map back to bounding boxes — exported annotated image & downloadable text file.</p>
      </div>
    </div>

    <aside class="card" style="color:#07203a; background:linear-gradient(180deg,#fff,#f8fbff);">
      <h2 style="margin:0 0 8px 0">Upload image for NER</h2>
      <div id="dropArea" class="drop-area">Drop image here or click to select (PNG/JPG/WebP)</div>
      <input id="fileInput" type="file" accept="image/*" style="display:none" />
      <div class="controls">
        <button id="chooseBtn" class="btn primary" style="padding:10px 14px; border-radius:10px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#fff; border:none; font-weight:800">Choose Image</button>
        <button id="uploadBtn" class="btn primary" disabled>Upload & Analyze</button>
      </div>
      <div id="status" style="margin-top:10px; color:#6b7280; font-weight:700"></div>
    </aside>
  </div>
</main>

<footer>© {{ year }} OCR+NER — All rights reserved.</footer>

<script>
(function(){
  const drop=document.getElementById('dropArea'), fi=document.getElementById('fileInput');
  const choose=document.getElementById('chooseBtn'), upload=document.getElementById('uploadBtn'), status=document.getElementById('status');
  let curr=null, MAX_MB=50;
  choose.addEventListener('click',()=>fi.click());
  drop.addEventListener('click',()=>fi.click());
  fi.addEventListener('change',()=>{ if(fi.files.length) handle(fi.files[0]); });

  ['dragenter','dragover'].forEach(e=>drop.addEventListener(e,ev=>{ ev.preventDefault(); drop.classList.add('dragover'); }));
  ['dragleave','dragend','drop'].forEach(e=>drop.addEventListener(e,ev=>{ ev.preventDefault(); drop.classList.remove('dragover'); }));
  drop.addEventListener('drop', ev=>{ ev.preventDefault(); const f = ev.dataTransfer && ev.dataTransfer.files && ev.dataTransfer.files[0]; if(f) handle(f); });

  function handle(f){
    if(!f) return; if(!(f.type && f.type.startsWith('image/')) && !(/\.(png|jpe?g|webp)$/i).test(f.name)){ status.textContent='❌ Only images allowed'; return; }
    if((f.size/(1024*1024))>MAX_MB){ status.textContent='❌ File too large'; return; }
    curr=f; status.textContent='Selected: '+f.name; upload.disabled=false;
  }

  upload.addEventListener('click', async ()=>{
    if(!curr){ status.textContent='❌ No file chosen'; return; }
    upload.disabled=true; choose.disabled=true; status.textContent='⏳ Uploading & analyzing...';
    const fd=new FormData(); fd.append('file', curr);
    try{
      const res=await fetch('/ner/upload', { method:'POST', body:fd });
      const html=await res.text();
      if(res.ok){ document.open(); document.write(html); document.close(); return; }
      else{ status.textContent='❌ Server error during NER'; console.error(res.status, html); }
    }catch(err){ status.textContent='❌ Network error'; }
    finally{ upload.disabled=false; choose.disabled=false; }
  });
})();
</script>
</body>
</html>
